
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Episode 8: self - Ruby is Magic – Das Blog</title>
  <meta name="author" content="Dirk Breuer & Sebastian Cohnen">

  
  <meta name="description" content="Schön, dass ihr wieder bei &#8216;Ruby is Magic&#8217; dabei seid. Heute wollen wir
uns ein wenig mit uns selbst, also self beschäftigen. Das ist &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rubyismagic.de/blog/2012/02/20/episode-8-self">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/rubyismagic" rel="alternate" title="Ruby is Magic – Das Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Walter+Turncoat' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruby is Magic – Das Blog</a></h1>
  
    <h2>Jetzt mit 20% mehr Inhalt</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/rubyismagic" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rubyismagic.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archiv</a></li>
  <li><a href="/showmaster">Showmaster</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Episode 8: Self</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-20T17:13:00+01:00" pubdate data-updated="true">Feb 20<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Schön, dass ihr wieder bei &#8216;Ruby is Magic&#8217; dabei seid. Heute wollen wir
uns ein wenig mit uns selbst, also <code>self</code> beschäftigen. Das ist wichtig und die
Grundlage für sehr viel von dem was wir hier so behandeln.</p>

<p>Am Anfang steht, wie so oft, zunächst eine kurze Begriffsklärung:</p>

<ul>
<li><code>self</code> ist ein Schlüsselwort (von denen es ja nicht so viele gibt)</li>
<li><code>self</code> zeigt immer auf das “aktuelle” Objekt</li>
<li><code>self</code> ist abhängig vom Kontext</li>
<li><code>self</code> ist der Default-Empfänger von Nachrichten</li>
</ul>


<!-- more -->


<p>Okay… Was lässt sich nun mit diesem <code>self</code> so alles machen? Eine Frage
die sich stellt, ist ob sich das Objekt auf das <code>self</code> zeigt ändern
lässt. Die Antwort ist typisch für Ruby: Ja, natürlich. Interessanter
ist da eher die Frage nach dem <em>Wie?</em> Naheliegend wäre es mit Zuweisung
zu versuchen:</p>

<figure class='code'><figcaption><span>self zuweisen  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">self</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dieser Code führt allerdings zu einem Fehler. Interessanterweise jedoch zu einem
syntaktischen Fehler:</p>

<figure class='code'><figcaption><span>Syntax-Fehler wenn man self zuweist  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SyntaxError</span><span class="p">:</span> <span class="no">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">change</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="nb">self</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wie lässt sich <code>self</code> also nun ändern, wenn nicht durch direkte
Zuweisung? Die Antwort ist schon unter den Eingangs gelisteten Punkten
zu finden: <code>self</code> ist abhängig vom Kontext. Es wird also immer dann
geändert, wenn der Kontext sich ändert. Der Kontext ändert sich
beispielsweise, wenn man eine Klasse definiert:</p>

<figure class='code'><figcaption><span>Kontextwechsel durch Klassendefinition  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pony</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">work</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Pony&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Pony</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">work</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:0x106da8368&gt;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Oder während eines Methodenaufrufs:</p>

<figure class='code'><figcaption><span>Kontextwechsel durch Methodenaufruf  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pony</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">other_pony</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> is on a visit.&quot;</span>
</span><span class='line'>    <span class="n">other_pony</span><span class="o">.</span><span class="n">is_pleased</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">is_pleased</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> is pleased about a visit.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Pony</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Applejack&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span> <span class="no">Pony</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Pinkie Pie&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:Applejack&gt; is on a visit.&quot;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:Pinkie Pie&gt; is pleased about a visit.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Beide Varianten werden alle regelmäßig verwenden und sich auch eher
nicht so aufregend. Spannend wird es, wenn wir uns mit <code>class_eval</code> oder
<code>instance_eval</code> beschäftigten</p>

<p>Beides Varianten, die man regelmäßig sieht und die (auf den ersten
Blick) wenig spannend daher kommen. Viel interessanter sind die
Varianten mit <code>class_eval</code>, <code>module_eval</code> und <code>instance_eval</code>:</p>

<figure class='code'><figcaption><span>Beispiel für class_eval  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pony</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Pony</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">work</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> is working!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Pony&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Pony</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">work</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:0x10bc98a68&gt; is working!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok, sieht so aus wie die Klassendefinition von vorhin nur etwas
umständlicher. Das Beispiel für <code>instance_eval</code> hält dann schon mehr
bereit:</p>

<figure class='code'><figcaption><span>Beispiel für instance_eval  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pony</span>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">age</span>
</span><span class='line'>    <span class="s2">&quot;Don&#39;t let anyone know!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">twilight_sparkle</span> <span class="o">=</span> <span class="no">Pony</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">twilight_sparkle</span>
</span><span class='line'><span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:0x10ba7b690&gt;&quot;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="n">main</span>
</span><span class='line'>
</span><span class='line'><span class="n">twilight_sparkle</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">age</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;#&lt;Pony:0x10ba7b690&gt;&quot;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Don&#39;t let anyone know!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Was passiert hier? Die Dokumentation zu <code>instance_eval</code> beschreibt die
Funktionalität wie folgt:</p>

<blockquote><p>Evaluates a string containing Ruby source code, or the given block,<br/>within the context of the receiver (obj). […]</p><footer><strong>Ruby-Dokumentation</strong> <cite><a href='http://www.ruby-doc.org/core-1.9.3/BasicObject.html#method-i-instance_eval'>www.ruby-doc.org/core-1.9.3/&hellip;</a></cite></footer></blockquote>


<p>Der Code-Block wird im Kontext des Empfängers ausgeführt. Es muss also
eine Kontextänderung stattfinden, und damit muss sich <code>self</code> ändern. Man
erhält dabei natürlich auch Zugriff auf die Instanzvariablen des
Empfängers. Neben Instanzvariablen erhalten wir hier aber auch Zugriff
auf die private Methode <code>age</code>. Warum dem so ist, erklärt unser erstes
Fun-Fact für heute.</p>

<h2>Fun Fact #1</h2>

<p>Private-Methoden lassen sich nur aufrufen wenn der Empfänger implizit
ist. Also unabhängig davon, ob die entsprechende Methode innerhalb der
Instanz aufgerufen wird oder nicht, wie folgendes Beispiel verdeutlichen
soll:</p>

<p><img class="right" src="/images/ponies/pinkie_pie.png" width="280" height="311"></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pony</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">want_to_know_age!</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">age</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">age</span>
</span><span class='line'>    <span class="s2">&quot;Don&#39;t let anyone know!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Pony</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">want_to_know_age!</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">NoMethodError</span><span class="p">:</span> <span class="s2">&quot;private method ‘age’</span>
</span><span class='line'><span class="s2">   called for #&lt;Pony:0x00…d8&gt;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>It&#8217;s all about methods</h2>

<p><img class="right" src="/images/posts/episode_8_self/superclass_hierarchy.png" width="371" height="285">
<img class="right" src="/images/posts/episode_8_self/extended_superclass_hierarchy.png" width="713" height="356">
<img class="right" src="/images/posts/episode_8_self/singleton_class.png" width="707" height="310">
<img class="right" src="/images/posts/episode_8_self/method_lookup.png" width="665" height="354"></p>

<h2>Präsentation</h2>

<p>Am Ende findet hier natürlich auch wieder die Vortragsfolien. Aber an
dieser Stelle möchten wir auch noch mal auf das Buch <a href="http://pragprog.com/book/ppmetr/metaprogramming-ruby">Metaprogramming Ruby</a> von <a href="http://ducktypo.blogspot.com/">Paolo Perrotta</a> hinweisen, dass uns sehr bei der
Recherche zu dieser Episode unterstützt hat. Es ist hervorragend geschriebenen
und wir können es nur jedem ans Herz legen, der sich intensiver mit der dieser
Thematik auseinander setzen möchte.</p>

<div style="width:595px" id="__ss_11676595"><object id="__sse11676595" width="595" height="497"> <param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=rubyismagic-episode-8-self-120220103700-phpapp01&rel=0&stripped_title=ruby-is-magic-episode-8-self&userName=railsbros_dirk" /> <param name="allowFullScreen" value="true"/> <param name="allowScriptAccess" value="always"/> <param name="wmode" value="transparent"/> <embed name="__sse11676595" src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=rubyismagic-episode-8-self-120220103700-phpapp01&rel=0&stripped_title=ruby-is-magic-episode-8-self&userName=railsbros_dirk" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="transparent" width="595" height="497"></embed> </object> </div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dirk Breuer & Sebastian Cohnen</span></span>

      








  


<time datetime="2012-02-20T17:13:00+01:00" pubdate data-updated="true">Feb 20<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/meta-programming/'>meta-programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rubyismagic.de/blog/2012/02/20/episode-8-self/" data-via="" data-counturl="http://rubyismagic.de/blog/2012/02/20/episode-8-self/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/02/09/behind-the-scenes-decorators/" title="Previous Post: Behind the Scenes: Decorators">&laquo; Behind the Scenes: Decorators</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Über uns</h1>
  <p>Dieser Blog begleitet unsere Vortragsreihe über die magischen Momente von Ruby auf der Kölner Ruby User Group <a href="http://twitter.com/colognerb">@colognerb</a>. Hier könnt ihr die Slides zu den Vorträgen finden und im Nachgang auch immer einen mehr oder weniger ausführlichen Artikel zum Thema.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/02/20/episode-8-self/">Episode 8: self</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/09/behind-the-scenes-decorators/">Behind the Scenes: Decorators</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/19/episode-7-closures/">Episode #7: Closures</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Dirk Breuer & Sebastian Cohnen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rubyismagic';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rubyismagic.de/blog/2012/02/20/episode-8-self/';
        var disqus_url = 'http://rubyismagic.de/blog/2012/02/20/episode-8-self/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
